<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HotStock Dashboard</title>

<!-- Latest Plotly -->
<script src="https://cdn.plot.ly/plotly-2.26.1.min.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.tabs { display: flex; cursor: pointer; margin-bottom: 10px; }
.tab { padding: 10px 20px; border: 1px solid #ccc; border-bottom: none; background: #f0f0f0; }
.tab.active { background: white; font-weight: bold; }
.tab-content { border: 1px solid #ccc; padding: 10px; display: none; }
.tab-content.active { display: block; }
#charts { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 10px; }
.chart { flex: 1 1 600px; min-width: 300px; }
table { border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
th { background-color: #f0f0f0; }
</style>
</head>
<body>

<h1>HotStock Dashboard</h1>

<label for="dateSelect">Select Date:</label>
<select id="dateSelect"></select>
<button id="loadBtn">Load Data</button>

<div class="tabs">
    <div class="tab active" data-tab="daily">Daily HotStocks</div>
    <div class="tab" data-tab="averages">Averages</div>
    <div class="tab" data-tab="hotscore">HotScore</div>
</div>

<div id="daily" class="tab-content active">
    <div id="dailyChart" class="chart"></div>
    <div id="dailyTable"></div>
</div>

<div id="averages" class="tab-content">
    <div id="avgChart" class="chart"></div>
    <div id="avgTable"></div>
</div>

<div id="hotscore" class="tab-content">
    <div id="hotscoreChart" class="chart"></div>
    <div id="hotscoreTable"></div>
</div>

<script>
// --- Helper to fetch CSV ---
async function fetchCSV(path) {
    try {
        const resp = await fetch(path);
        if (!resp.ok) throw new Error("File not found: " + path);
        const text = await resp.text();
        const rows = text.trim().split("\n").map(r => r.split(","));
        const headers = rows.shift();
        return rows.map(r => Object.fromEntries(r.map((v,i) => [headers[i],v])));
    } catch(e) {
        console.error(e);
        return [];
    }
}

// --- Populate dropdown (replace with dynamic JSON listing if available) ---
const availableDates = ["20251119_0930","20251119_1000","20251119_1030"];
const dateSelect = document.getElementById("dateSelect");
dateSelect.innerHTML = availableDates.map(d => `<option value="${d}">${d}</option>`).join("");

// --- Tab switching ---
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
    });
});

// --- Load data and populate charts/tables ---
document.getElementById("loadBtn").addEventListener("click", async () => {
    const date = dateSelect.value;
    if (!date) return alert("Select a date first.");

    // Load CSVs
    const daily = await fetchCSV(`data/daily/hot_stocks_${date}.csv`);
    const averages = await fetchCSV(`data/averages/avg_${date}.csv`);
    const hotscore = await fetchCSV(`data/hotscore/hotscore_${date}.csv`);

    // --- Daily Chart ---
    if (daily.length) {
        const symbols = daily.map(r => r.symbol);
        const scores = daily.map(r => parseFloat(r.HotScore));
        Plotly.newPlot('dailyChart', [{x: symbols, y: scores, type:'bar', marker:{color:'blue'}}],
            {title: `Daily HotStocks - ${date}`, xaxis:{title:"Symbol"}, yaxis:{title:"HotScore"}});
        
        const dailyTableDiv = document.getElementById("dailyTable");
        const table = document.createElement("table");
        const headerRow = `<tr>${Object.keys(daily[0]).map(h => `<th>${h}</th>`).join("")}</tr>`;
        table.innerHTML = headerRow + daily.slice(0,20).map(r => 
            `<tr>${Object.values(r).map(v => `<td>${v}</td>`).join("")}</tr>`
        ).join("");
        dailyTableDiv.innerHTML = "<h3>Top Daily HotStocks</h3>";
        dailyTableDiv.appendChild(table);
    }

    // --- Averages Chart ---
    if (averages.length) {
        const symbols = averages.map(r => r.symbol);
        const hotScores = averages.map(r => parseFloat(r.HotScore));
        Plotly.newPlot('avgChart', [{x: symbols, y: hotScores, type:'bar', marker:{color:'green'}}],
            {title:`Average HotScore - ${date}`, xaxis:{title:"Symbol"}, yaxis:{title:"Avg HotScore"}});
        
        const avgTableDiv = document.getElementById("avgTable");
        const table = document.createElement("table");
        const headerRow = `<tr>${Object.keys(averages[0]).map(h => `<th>${h}</th>`).join("")}</tr>`;
        table.innerHTML = headerRow + averages.slice(0,20).map(r => 
            `<tr>${Object.values(r).map(v => `<td>${v}</td>`).join("")}</tr>`
        ).join("");
        avgTableDiv.innerHTML = "<h3>Top Averages</h3>";
        avgTableDiv.appendChild(table);
    }

    // --- HotScore Chart ---
    if (hotscore.length) {
        const symbols = hotscore.map(r => r.symbol);
        const scores = hotscore.map(r => parseFloat(r.HotScore));
        Plotly.newPlot('hotscoreChart', [{x: symbols, y: scores, type:'bar', marker:{color:'orange'}}],
            {title:`HotScore Top Symbols - ${date}`, xaxis:{title:"Symbol"}, yaxis:{title:"HotScore"}});
        
        const tableDiv = document.getElementById("hotscoreTable");
        const table = document.createElement("table");
        const headerRow = `<tr>${Object.keys(hotscore[0]).map(h => `<th>${h}</th>`).join("")}</tr>`;
        table.innerHTML = headerRow + hotscore.slice(0,20).map(r => 
            `<tr>${Object.values(r).map(v => `<td>${v}</td>`).join("")}</tr>`
        ).join("");
        tableDiv.innerHTML = "<h3>HotScore Table</h3>";
        tableDiv.appendChild(table);
    }
});
</script>

</body>
</html>
